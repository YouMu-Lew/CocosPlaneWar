{"version":3,"sources":["file:///D:/myCocos/cocosProjects/FamousGamesImitations/CrampedRoomOfDeathDemo/assets/scripts/Tile/TileMapManager.ts"],"names":["_decorator","Component","Layers","Node","resources","Sprite","SpriteFrame","UITransform","levels","ccclass","property","TILE_WIDTH","TILE_HEIGHT","TileMapManager","init","mapInfo","spriteFrames","loadRes","console","log","i","length","column","item","j","src","type","tile","sprite","addComponent","imgSrc","spriteFrame","find","v","name","transform","setContentSize","layer","Enum","UI_2D","setPosition","setParent","node","Promise","resolve","reject","loadDir","err","assets","start","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAwBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,W,OAAAA,W;;AACpFC,MAAAA,M;;;;;;;;;OACD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;4BAEjBW,U,GAAa,E;;6BACbC,W,GAAc,E;;gCAGdC,c,WADZJ,OAAO,CAAC,gBAAD,C,gBAAR,MACaI,cADb,SACoCZ,SADpC,CAC8C;AACpCa,QAAAA,IAAI,GAAG;AAAA;;AAAA;AACT,gBAAM;AAACC,cAAAA;AAAD,gBAAY;AAAA;AAAA,4CAAe,CAAf,CAAlB;AACA,gBAAMC,YAAY,SAAS,KAAI,CAACC,OAAL,EAA3B;AACAC,YAAAA,OAAO,CAACC,GAAR,CAAYH,YAAZ;;AAEA,iBAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,OAAO,CAACM,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGP,OAAO,CAACK,CAAD,CAAtB;;AADqC,4CAEG;AACpC,oBAAMG,IAAI,GAAGD,MAAM,CAACE,CAAD,CAAnB;AACA,oBAAGD,IAAI,CAACE,GAAL,KAAa,IAAb,IAAqBF,IAAI,CAACG,IAAL,KAAc,IAAtC;AAGA;;AACA,oBAAMC,IAAI,GAAG,IAAIxB,IAAJ,EAAb;AACA,oBAAMyB,MAAM,GAAGD,IAAI,CAACE,YAAL,CAAkBxB,MAAlB,CAAf;AACA,oBAAMyB,MAAM,cAAYP,IAAI,CAACE,GAAjB,MAAZ;AACAG,gBAAAA,MAAM,CAACG,WAAP,GAAqBf,YAAY,CAACgB,IAAb,CAAkBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,MAAlC,KAA6Cd,YAAY,CAAC,CAAD,CAA9E;AAEA,oBAAMmB,SAAS,GAAGR,IAAI,CAACE,YAAL,CAAkBtB,WAAlB,CAAlB;AACA4B,gBAAAA,SAAS,CAACC,cAAV,CAAyBzB,UAAzB,EAAoCC,WAApC;AAEAe,gBAAAA,IAAI,CAACU,KAAL,GAAanC,MAAM,CAACoC,IAAP,CAAYC,KAAzB;AACAZ,gBAAAA,IAAI,CAACa,WAAL,CAAiBpB,CAAC,GAAGT,UAArB,EAAgC,CAACa,CAAD,GAAKZ,WAArC;AAEAe,gBAAAA,IAAI,CAACc,SAAL,CAAe,KAAI,CAACC,IAApB;AACH,eApBoC;;AAErC,mBAAK,IAAIlB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,MAAM,CAACD,MAA3B,EAAmCG,CAAC,EAApC;AAAA,oCAGQ;AAHR;AAmBH;AA1BQ;AA2BZ;AAED;AACJ;AACA;;;AACIP,QAAAA,OAAO,GAAE;AACL,iBAAO,IAAI0B,OAAJ,CAA2B,CAACC,OAAD,EAASC,MAAT,KAAkB;AAChDzC,YAAAA,SAAS,CAAC0C,OAAV,CAAkB,mBAAlB,EAAuCxC,WAAvC,EAAoD,UAAUyC,GAAV,EAAeC,MAAf,EAAuB;AACvE,kBAAGD,GAAH,EAAO;AACHF,gBAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACH;;AAEDH,cAAAA,OAAO,CAACI,MAAD,CAAP;AACH,aAPD;AAQH,WATM,CAAP;AAWH;;AAEDC,QAAAA,KAAK,GAAG,CAEP;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AArDyC,O","sourcesContent":["import { _decorator, Component, ForwardFlow, Layers, Node, resources, Sprite, SpriteFrame, UITransform } from 'cc';\r\nimport levels from '../../Levels';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport const TILE_WIDTH = 55;\r\nexport const TILE_HEIGHT = 55;\r\n\r\n@ccclass('TileMapManager')\r\nexport class TileMapManager extends Component {\r\n    async init() {\r\n        const {mapInfo} = levels[`level${1}`];\r\n        const spriteFrames = await this.loadRes();\r\n        console.log(spriteFrames);\r\n\r\n        for (let i = 0; i < mapInfo.length; i++) {\r\n            const column = mapInfo[i];\r\n            for (let j = 0; j < column.length; j++) {\r\n                const item = column[j];\r\n                if(item.src === null || item.type === null)\r\n                    continue;\r\n\r\n                // 创建Tile\r\n                const tile = new Node();\r\n                const sprite = tile.addComponent(Sprite);\r\n                const imgSrc = `tile (${item.src})`;\r\n                sprite.spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0];\r\n\r\n                const transform = tile.addComponent(UITransform);\r\n                transform.setContentSize(TILE_WIDTH,TILE_HEIGHT);\r\n\r\n                tile.layer = Layers.Enum.UI_2D;\r\n                tile.setPosition(i * TILE_WIDTH,-j * TILE_HEIGHT);\r\n\r\n                tile.setParent(this.node);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 官方为回调函数写法，不太好写，封装为 Promise\r\n     */\r\n    loadRes(){\r\n        return new Promise<SpriteFrame[]>((resolve,reject)=>{\r\n            resources.loadDir(\"texture/tile/tile\", SpriteFrame, function (err, assets) {\r\n                if(err){\r\n                    reject(err);\r\n                    return;\r\n                }\r\n\r\n                resolve(assets);\r\n            });\r\n        })\r\n\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}