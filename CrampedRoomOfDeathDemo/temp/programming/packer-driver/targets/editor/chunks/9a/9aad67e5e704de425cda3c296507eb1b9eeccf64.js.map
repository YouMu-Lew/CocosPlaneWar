{"version":3,"sources":["file:///D:/myCocos/cocosProjects/FamousGamesImitations/CrampedRoomOfDeathDemo/assets/scripts/Tile/TileMapManager.ts"],"names":["_decorator","Component","Layers","Node","resources","Sprite","SpriteFrame","UITransform","levels","ccclass","property","TILE_WIDTH","TILE_HEIGHT","TileMapManager","init","mapInfo","spriteFrames","loadRes","console","log","i","length","column","j","item","src","type","tile","sprite","addComponent","imgSrc","spriteFrame","find","v","name","transform","setContentSize","layer","Enum","UI_2D","setPosition","setParent","node","Promise","resolve","reject","loadDir","err","assets","start","update","deltaTime"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAwBC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,W,OAAAA,W;;AACpFC,MAAAA,M;;;;;;;;;OACD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;4BAEjBW,U,GAAa,E;;6BACbC,W,GAAc,E;;gCAGdC,c,WADZJ,OAAO,CAAC,gBAAD,C,gBAAR,MACaI,cADb,SACoCZ,SADpC,CAC8C;AAChC,cAAJa,IAAI,GAAG;AACT,gBAAM;AAACC,YAAAA;AAAD,cAAY;AAAA;AAAA,gCAAQ,QAAO,CAAE,EAAjB,CAAlB;AACA,gBAAMC,YAAY,GAAG,MAAM,KAAKC,OAAL,EAA3B;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYH,YAAZ;;AAEA,eAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,OAAO,CAACM,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGP,OAAO,CAACK,CAAD,CAAtB;;AACA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACD,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACpC,oBAAMC,IAAI,GAAGF,MAAM,CAACC,CAAD,CAAnB;AACA,kBAAGC,IAAI,CAACC,GAAL,KAAa,IAAb,IAAqBD,IAAI,CAACE,IAAL,KAAc,IAAtC,EACI,SAHgC,CAKpC;;AACA,oBAAMC,IAAI,GAAG,IAAIxB,IAAJ,EAAb;AACA,oBAAMyB,MAAM,GAAGD,IAAI,CAACE,YAAL,CAAkBxB,MAAlB,CAAf;AACA,oBAAMyB,MAAM,GAAI,SAAQN,IAAI,CAACC,GAAI,GAAjC;AACAG,cAAAA,MAAM,CAACG,WAAP,GAAqBf,YAAY,CAACgB,IAAb,CAAkBC,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWJ,MAAlC,KAA6Cd,YAAY,CAAC,CAAD,CAA9E;AAEA,oBAAMmB,SAAS,GAAGR,IAAI,CAACE,YAAL,CAAkBtB,WAAlB,CAAlB;AACA4B,cAAAA,SAAS,CAACC,cAAV,CAAyBzB,UAAzB,EAAoCC,WAApC;AAEAe,cAAAA,IAAI,CAACU,KAAL,GAAanC,MAAM,CAACoC,IAAP,CAAYC,KAAzB;AACAZ,cAAAA,IAAI,CAACa,WAAL,CAAiBpB,CAAC,GAAGT,UAArB,EAAgC,CAACY,CAAD,GAAKX,WAArC;AAEAe,cAAAA,IAAI,CAACc,SAAL,CAAe,KAAKC,IAApB;AACH;AACJ;AACJ;AAED;AACJ;AACA;;;AACIzB,QAAAA,OAAO,GAAE;AACL,iBAAO,IAAI0B,OAAJ,CAA2B,CAACC,OAAD,EAASC,MAAT,KAAkB;AAChDzC,YAAAA,SAAS,CAAC0C,OAAV,CAAkB,mBAAlB,EAAuCxC,WAAvC,EAAoD,UAAUyC,GAAV,EAAeC,MAAf,EAAuB;AACvE,kBAAGD,GAAH,EAAO;AACHF,gBAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACH;;AAEDH,cAAAA,OAAO,CAACI,MAAD,CAAP;AACH,aAPD;AAQH,WATM,CAAP;AAWH;;AAEDC,QAAAA,KAAK,GAAG,CAEP;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CAEzB;;AArDyC,O","sourcesContent":["import { _decorator, Component, ForwardFlow, Layers, Node, resources, Sprite, SpriteFrame, UITransform } from 'cc';\r\nimport levels from '../../Levels';\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport const TILE_WIDTH = 55;\r\nexport const TILE_HEIGHT = 55;\r\n\r\n@ccclass('TileMapManager')\r\nexport class TileMapManager extends Component {\r\n    async init() {\r\n        const {mapInfo} = levels[`level${1}`];\r\n        const spriteFrames = await this.loadRes();\r\n        console.log(spriteFrames);\r\n\r\n        for (let i = 0; i < mapInfo.length; i++) {\r\n            const column = mapInfo[i];\r\n            for (let j = 0; j < column.length; j++) {\r\n                const item = column[j];\r\n                if(item.src === null || item.type === null)\r\n                    continue;\r\n\r\n                // 创建Tile\r\n                const tile = new Node();\r\n                const sprite = tile.addComponent(Sprite);\r\n                const imgSrc = `tile (${item.src})`;\r\n                sprite.spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0];\r\n\r\n                const transform = tile.addComponent(UITransform);\r\n                transform.setContentSize(TILE_WIDTH,TILE_HEIGHT);\r\n\r\n                tile.layer = Layers.Enum.UI_2D;\r\n                tile.setPosition(i * TILE_WIDTH,-j * TILE_HEIGHT);\r\n\r\n                tile.setParent(this.node);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 官方为回调函数写法，不太好写，封装为 Promise\r\n     */\r\n    loadRes(){\r\n        return new Promise<SpriteFrame[]>((resolve,reject)=>{\r\n            resources.loadDir(\"texture/tile/tile\", SpriteFrame, function (err, assets) {\r\n                if(err){\r\n                    reject(err);\r\n                    return;\r\n                }\r\n\r\n                resolve(assets);\r\n            });\r\n        })\r\n\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}